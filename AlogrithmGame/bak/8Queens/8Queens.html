<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>8çš‡åæ¸¸æˆ</title>
    <style>
      body {
        font-family: "Arial", sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #333;
        padding: 20px;
        box-sizing: border-box;
      }

      .game-container {
        display: flex;
        gap: 30px;
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        max-width: 95vw;
        max-height: 95vh;
        align-items: flex-start;
      }

      .main-game {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-width: 0;
      }

      .sidebar {
        width: 200px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        flex-shrink: 0;
      }

      h1 {
        color: #4a5568;
        margin-bottom: 20px;
        font-size: 2em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .board {
        display: grid;
        grid-template-columns: repeat(8, 50px);
        grid-template-rows: repeat(8, 50px);
        gap: 2px;
        margin: 20px auto;
        border: 3px solid #4a5568;
        border-radius: 8px;
        padding: 10px;
        background: #2d3748;
        max-width: calc(100vw - 300px);
        max-height: calc(100vh - 200px);
      }

      .square {
        width: 50px;
        height: 50px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        font-size: 32px;
        border-radius: 4px;
        transition: all 0.3s ease;
        position: relative;
      }

      .square:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .light {
        background-color: #f7fafc;
      }

      .dark {
        background-color: #e2e8f0;
      }

      .queen {
        color: #2d3748;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        animation: placeQueen 0.3s ease-out;
        background-color: rgb(173, 216, 230) !important;
        border-radius: 8px;
      }

      @keyframes placeQueen {
        0% {
          transform: scale(0);
          opacity: 0;
        }
        50% {
          transform: scale(1.2);
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .conflict {
        background-color: #fed7d7 !important;
        animation: shake 0.5s ease-in-out;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }

      .stats {
        display: flex;
        flex-direction: column;
        gap: 15px;
        padding: 20px;
        background-color: #f7fafc;
        border-radius: 8px;
        border: 2px solid #e2e8f0;
      }

      .stat-item {
        text-align: center;
        padding: 10px;
        background: white;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .stat-number {
        font-size: 28px;
        font-weight: bold;
        color: #667eea;
        display: block;
      }

      .stat-label {
        font-size: 12px;
        color: #718096;
        text-transform: uppercase;
        margin-top: 5px;
      }

      .controls {
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        align-items: center;
        width: 100%;
      }

      .control-row {
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
        width: 100%;
      }

      .board-size-control {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        background: #f7fafc;
        padding: 15px;
        border-radius: 8px;
        border: 2px solid #e2e8f0;
        width: 100%;
      }

      .size-input-row {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .size-input-row button {
        width: auto;
        flex-shrink: 0;
      }

      .board-size-control label {
        font-weight: bold;
        color: #4a5568;
        font-size: 14px;
      }

      .board-size-control input {
        width: 60px;
        padding: 8px;
        border: 2px solid #cbd5e0;
        border-radius: 4px;
        text-align: center;
        font-size: 16px;
        font-weight: bold;
      }

      .board-size-control input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      button {
        padding: 10px 16px;
        font-size: 14px;
        cursor: pointer;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 20px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        white-space: nowrap;
        width: 100%;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      button:active {
        transform: translateY(0);
      }

      #message {
        margin-top: 20px;
        font-size: 16px;
        font-weight: bold;
        min-height: 24px;
        padding: 15px;
        border-radius: 8px;
        transition: all 0.3s ease;
        text-align: center;
        max-width: 100%;
        word-wrap: break-word;
      }

      .success {
        background-color: #c6f6d5;
        color: #22543d;
        border: 2px solid #38a169;
      }

      .error {
        background-color: #fed7d7;
        color: #742a2a;
        border: 2px solid #e53e3e;
      }

      .info {
        background-color: #bee3f8;
        color: #2a4365;
        border: 2px solid #3182ce;
      }

      .rules {
        margin-top: 20px;
        padding: 15px;
        background-color: #f7fafc;
        border-radius: 8px;
        text-align: left;
        font-size: 13px;
        line-height: 1.5;
        border: 2px solid #e2e8f0;
      }

      .rules h3 {
        margin-top: 0;
        color: #4a5568;
        font-size: 16px;
      }

      .rules ul {
        margin: 10px 0;
        padding-left: 20px;
      }

      .rules li {
        margin-bottom: 5px;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 1024px) {
        .game-container {
          flex-direction: column;
          align-items: center;
        }

        .sidebar {
          width: 100%;
          max-width: 500px;
        }

        .stats {
          flex-direction: row;
          justify-content: space-around;
        }

        .stat-item {
          flex: 1;
          margin: 0 5px;
        }

        .control-row {
          flex-direction: row;
          flex-wrap: wrap;
          justify-content: center;
        }

        .control-row button {
          flex: 1;
          min-width: 120px;
        }
      }

      @media (max-width: 768px) {
        .board {
          grid-template-columns: repeat(8, 40px);
          grid-template-rows: repeat(8, 40px);
        }

        .square {
          width: 40px;
          height: 40px;
          font-size: 28px;
        }

        .game-container {
          padding: 20px;
        }

        .control-row {
          flex-direction: column;
        }

        .control-row button {
          width: 100%;
        }
      }

      /* é«˜äº®æ ·å¼ */
      .highlight-row {
        background-color: rgb(245, 231, 138) !important;
        box-shadow: inset 0 0 0 1px rgba(255, 193, 7, 0.8);
      }

      .highlight-col {
        background-color: rgb(245, 231, 138) !important;
        box-shadow: inset 0 0 0 1px rgba(255, 193, 7, 0.8);
      }

      .highlight-diagonal {
        background-color: rgb(245, 231, 138) !important;
        box-shadow: inset 0 0 0 1px rgba(255, 193, 7, 0.8);
      }

      .highlight-intersection {
        background-color: rgba(54, 248, 255, 0.7) !important;
        box-shadow: inset 0 0 0 1px rgba(255, 65, 54, 0.8);
        transform: scale(1.02);
      }

      .square.highlight-row,
      .square.highlight-col,
      .square.highlight-diagonal,
      .square.highlight-intersection {
        z-index: 10;
        position: relative;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <div class="main-game">
        <h1>8çš‡åæ¸¸æˆ</h1>
        <div class="board" id="chessboard"></div>
        <div id="message" class="info">
          ç‚¹å‡»æ£‹ç›˜æ”¾ç½®çš‡åã€‚ç›®æ ‡ï¼šæ”¾ç½®8ä¸ªçš‡åä¸”äº’ä¸æ”»å‡»ï¼
        </div>
      </div>

      <div class="sidebar">
        <div class="stats">
          <div class="stat-item">
            <div class="stat-number" id="queens-count">0</div>
            <div class="stat-label">å·²æ”¾ç½®çš‡å</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="conflicts-count">0</div>
            <div class="stat-label">å†²çªæ•°é‡</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="moves-count">0</div>
            <div class="stat-label">ç§»åŠ¨æ¬¡æ•°</div>
          </div>
        </div>

        <div class="controls">
          <div class="board-size-control">
            <label for="board-size">æ£‹ç›˜å¤§å°:</label>
            <div class="size-input-row">
              <input type="number" id="board-size" min="1" max="8" value="8" />
              <button id="apply-size-btn">åº”ç”¨</button>
            </div>
          </div>

          <div class="control-row">
            <button id="reset-btn">é‡ç½®æ£‹ç›˜</button>
            <button id="hint-btn">æç¤º</button>
            <button id="solve-btn">è‡ªåŠ¨æ±‚è§£</button>
          </div>
        </div>

        <div class="rules">
          <h3>æ¸¸æˆè§„åˆ™ï¼š</h3>
          <ul>
            <li>åœ¨8Ã—8æ£‹ç›˜ä¸Šæ”¾ç½®8ä¸ªçš‡å</li>
            <li>ä»»æ„ä¸¤ä¸ªçš‡åä¸èƒ½åœ¨åŒä¸€è¡Œã€åŒä¸€åˆ—æˆ–åŒä¸€å¯¹è§’çº¿ä¸Š</li>
            <li>ç‚¹å‡»ç©ºæ ¼æ”¾ç½®çš‡åï¼Œç‚¹å‡»çš‡åç§»é™¤å®ƒ</li>
            <li>çº¢è‰²èƒŒæ™¯è¡¨ç¤ºçš‡åä¹‹é—´å­˜åœ¨å†²çª</li>
            <li>æˆåŠŸæ”¾ç½®8ä¸ªçš‡åä¸”æ— å†²çªå³è·èƒœï¼</li>
          </ul>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const board = document.getElementById("chessboard");
        const resetBtn = document.getElementById("reset-btn");
        const hintBtn = document.getElementById("hint-btn");
        const solveBtn = document.getElementById("solve-btn");
        const applySizeBtn = document.getElementById("apply-size-btn");
        const boardSizeInput = document.getElementById("board-size");
        const messageEl = document.getElementById("message");
        const queensCountEl = document.getElementById("queens-count");
        const conflictsCountEl = document.getElementById("conflicts-count");
        const movesCountEl = document.getElementById("moves-count");

        let boardSize = 8;
        let queens = [];
        let boardState = Array(boardSize)
          .fill()
          .map(() => Array(boardSize).fill(0));
        let moveCount = 0;
        let isAnimating = false;

        // æ›´æ–°æ£‹ç›˜å¤§å°
        function updateBoardSize() {
          const newSize = parseInt(boardSizeInput.value);
          if (newSize >= 1 && newSize <= 8) {
            boardSize = newSize;

            // æ›´æ–°CSSç½‘æ ¼
            board.style.gridTemplateColumns = `repeat(${boardSize}, 50px)`;
            board.style.gridTemplateRows = `repeat(${boardSize}, 50px)`;

            // é‡æ–°åˆå§‹åŒ–æ£‹ç›˜
            initBoard();

            // æ›´æ–°æ¸¸æˆè§„åˆ™æ–‡æœ¬
            updateRulesText();
          } else {
            setMessage("æ£‹ç›˜å¤§å°å¿…é¡»åœ¨1-8ä¹‹é—´ï¼", "error");
            boardSizeInput.value = boardSize;
          }
        }

        // æ›´æ–°è§„åˆ™æ–‡æœ¬
        function updateRulesText() {
          const rulesText = document.querySelector(".rules ul");
          rulesText.innerHTML = `
            <li>åœ¨${boardSize}Ã—${boardSize}æ£‹ç›˜ä¸Šæ”¾ç½®${boardSize}ä¸ªçš‡å</li>
            <li>ä»»æ„ä¸¤ä¸ªçš‡åä¸èƒ½åœ¨åŒä¸€è¡Œã€åŒä¸€åˆ—æˆ–åŒä¸€å¯¹è§’çº¿ä¸Š</li>
            <li>ç‚¹å‡»ç©ºæ ¼æ”¾ç½®çš‡åï¼Œç‚¹å‡»çš‡åç§»é™¤å®ƒ</li>
            <li>çº¢è‰²èƒŒæ™¯è¡¨ç¤ºçš‡åä¹‹é—´å­˜åœ¨å†²çª</li>
            <li>æˆåŠŸæ”¾ç½®${boardSize}ä¸ªçš‡åä¸”æ— å†²çªå³è·èƒœï¼</li>
          `;
        }

        // åˆå§‹åŒ–æ£‹ç›˜
        function initBoard() {
          board.innerHTML = "";
          queens = [];
          boardState = Array(boardSize)
            .fill()
            .map(() => Array(boardSize).fill(0));
          moveCount = 0;
          isAnimating = false;
          updateStats();
          setMessage(
            `ç‚¹å‡»æ£‹ç›˜æ”¾ç½®çš‡åã€‚ç›®æ ‡ï¼šæ”¾ç½®${boardSize}ä¸ªçš‡åä¸”äº’ä¸æ”»å‡»ï¼`,
            "info"
          );

          for (let row = 0; row < boardSize; row++) {
            for (let col = 0; col < boardSize; col++) {
              const square = document.createElement("div");
              square.className = `square ${
                (row + col) % 2 === 0 ? "light" : "dark"
              }`;
              square.dataset.row = row;
              square.dataset.col = col;
              square.addEventListener("click", () =>
                handleSquareClick(row, col)
              );
              board.appendChild(square);
            }
          }
        }

        // å¤„ç†æ–¹æ ¼ç‚¹å‡»
        function handleSquareClick(row, col) {
          if (isAnimating) return;

          // å¦‚æœç‚¹å‡»çš„æ˜¯ç©ºæ–¹æ ¼
          if (!boardState[row][col]) {
            // æ£€æŸ¥ä½ç½®æ˜¯å¦å®‰å…¨
            if (isSafe(row, col)) {
              // å®‰å…¨ä½ç½®ï¼šæ˜¾ç¤ºé«˜äº®å¹¶æ”¾ç½®çš‡å
              highlightAttackLines(row, col);

              // å»¶è¿Ÿæ‰§è¡Œæ”¾ç½®çš‡åï¼Œè®©ç”¨æˆ·çœ‹åˆ°é«˜äº®æ•ˆæœ
              setTimeout(() => {
                toggleQueen(row, col);
                // æˆåŠŸæ”¾ç½®åä¿æŒé«˜äº®
                maintainHighlightForQueen(row, col);
              }, 300);
            } else {
              // ä¸å®‰å…¨ä½ç½®ï¼šåªæ˜¾ç¤ºä¸´æ—¶é«˜äº®ï¼Œä¸æ”¾ç½®çš‡å
              highlightAttackLines(row, col);
              setMessage("æ­¤ä½ç½®ä¸å®‰å…¨ï¼çš‡åä¼šè¢«æ”»å‡»", "error");

              // 2ç§’åæ¸…é™¤é«˜äº®å’Œé”™è¯¯æ¶ˆæ¯
              setTimeout(() => {
                clearTemporaryHighlights();
                updateGameMessage();
              }, 2000);
            }
          } else {
            // å¦‚æœç‚¹å‡»çš„æ˜¯çš‡åï¼Œç§»é™¤å®ƒå’Œç›¸å…³é«˜äº®
            removeQueenAndHighlight(row, col);
          }
        }

        // ä¸ºæˆåŠŸæ”¾ç½®çš„çš‡åç»´æŒé«˜äº®
        function maintainHighlightForQueen(targetRow, targetCol) {
          for (let row = 0; row < boardSize; row++) {
            for (let col = 0; col < boardSize; col++) {
              const square = document.querySelector(
                `[data-row="${row}"][data-col="${col}"]`
              );

              // ä¸ºè¿™ä¸ªçš‡åçš„æ”»å‡»çº¿æ·»åŠ æ°¸ä¹…é«˜äº®
              if (row === targetRow && col !== targetCol) {
                square.classList.add("highlight-row");
              }

              if (col === targetCol && row !== targetRow) {
                square.classList.add("highlight-col");
              }

              if (
                Math.abs(row - targetRow) === Math.abs(col - targetCol) &&
                !(row === targetRow && col === targetCol)
              ) {
                square.classList.add("highlight-diagonal");
              }

              if (row === targetRow && col === targetCol) {
                square.classList.add("highlight-intersection");
              }
            }
          }
        }

        // ç§»é™¤çš‡åå’Œç›¸å…³é«˜äº®
        function removeQueenAndHighlight(row, col) {
          // ç§»é™¤çš‡å
          boardState[row][col] = 0;
          queens = queens.filter((q) => !(q.row === row && q.col === col));
          moveCount++;

          // é‡æ–°è®¡ç®—æ‰€æœ‰é«˜äº®
          clearHighlights();

          // ä¸ºå‰©ä½™çš„çš‡åé‡æ–°æ·»åŠ é«˜äº®
          queens.forEach((queen) => {
            maintainHighlightForQueen(queen.row, queen.col);
          });

          updateBoard();
          updateStats();
          checkWin();
        }

        // é«˜äº®æ”»å‡»çº¿ï¼ˆä¸´æ—¶æ˜¾ç¤ºï¼‰
        function highlightAttackLines(targetRow, targetCol) {
          // ä¸æ¸…é™¤ç°æœ‰çš„æ°¸ä¹…é«˜äº®ï¼Œåªæ·»åŠ ä¸´æ—¶é«˜äº®
          for (let row = 0; row < boardSize; row++) {
            for (let col = 0; col < boardSize; col++) {
              const square = document.querySelector(
                `[data-row="${row}"][data-col="${col}"]`
              );

              // é«˜äº®åŒä¸€è¡Œ
              if (row === targetRow && col !== targetCol) {
                square.classList.add("highlight-row");
              }

              // é«˜äº®åŒä¸€åˆ—
              if (col === targetCol && row !== targetRow) {
                square.classList.add("highlight-col");
              }

              // é«˜äº®å¯¹è§’çº¿
              if (
                Math.abs(row - targetRow) === Math.abs(col - targetCol) &&
                !(row === targetRow && col === targetCol)
              ) {
                square.classList.add("highlight-diagonal");
              }

              // é«˜äº®äº¤å‰ç‚¹ï¼ˆç›®æ ‡æ–¹æ ¼ï¼‰
              if (row === targetRow && col === targetCol) {
                square.classList.add("highlight-intersection");
              }
            }
          }
        }

        // æ¸…é™¤ä¸´æ—¶é«˜äº®ï¼ˆä¿ç•™æ°¸ä¹…é«˜äº®ï¼‰
        function clearTemporaryHighlights() {
          // æ¸…é™¤æ‰€æœ‰é«˜äº®
          clearHighlights();

          // é‡æ–°ä¸ºç°æœ‰çš‡åæ·»åŠ æ°¸ä¹…é«˜äº®
          queens.forEach((queen) => {
            maintainHighlightForQueen(queen.row, queen.col);
          });
        }

        // æ¸…é™¤æ‰€æœ‰é«˜äº®
        function clearHighlights() {
          document.querySelectorAll(".square").forEach((square) => {
            square.classList.remove(
              "highlight-row",
              "highlight-col",
              "highlight-diagonal",
              "highlight-intersection"
            );
          });
        }

        // æ›´æ–°æ¸¸æˆæ¶ˆæ¯
        function updateGameMessage() {
          if (queens.length === 0) {
            setMessage(
              `ç‚¹å‡»æ£‹ç›˜æ”¾ç½®çš‡åã€‚ç›®æ ‡ï¼šæ”¾ç½®${boardSize}ä¸ªçš‡åä¸”äº’ä¸æ”»å‡»ï¼`,
              "info"
            );
          } else {
            const conflictCount = document.querySelectorAll(".conflict").length;
            if (conflictCount > 0) {
              setMessage(
                `å·²æ”¾ç½® ${queens.length}/${boardSize} ä¸ªçš‡åï¼Œ${conflictCount} ä¸ªå†²çª`,
                "error"
              );
            } else {
              setMessage(
                `å·²æ”¾ç½® ${queens.length}/${boardSize} ä¸ªçš‡åï¼Œç»§ç»­åŠ æ²¹ï¼`,
                "info"
              );
            }
          }
        }

        // åˆ‡æ¢çš‡åæ”¾ç½®ï¼ˆä»…ç”¨äºæˆåŠŸæ”¾ç½®ï¼‰
        function toggleQueen(row, col) {
          if (isAnimating) return;

          // åªå¤„ç†æ·»åŠ çš‡åçš„æƒ…å†µï¼ˆç§»é™¤ç”±removeQueenAndHighlightå¤„ç†ï¼‰
          if (!boardState[row][col]) {
            boardState[row][col] = 1;
            queens.push({ row, col });
          }

          updateBoard();
          updateStats();
          checkWin();
        }

        // æ›´æ–°æ£‹ç›˜è§†è§‰æ•ˆæœ
        function updateBoard() {
          // é‡ç½®æ‰€æœ‰æ–¹æ ¼ï¼ˆä¿ç•™é«˜äº®ï¼‰
          document.querySelectorAll(".square").forEach((square) => {
            square.classList.remove("queen", "conflict");
            square.textContent = "";
          });

          // æ£€æŸ¥å†²çª
          const conflicts = new Set();
          for (let i = 0; i < queens.length; i++) {
            for (let j = i + 1; j < queens.length; j++) {
              const q1 = queens[i];
              const q2 = queens[j];

              if (
                q1.row === q2.row ||
                q1.col === q2.col ||
                Math.abs(q1.row - q2.row) === Math.abs(q1.col - q2.col)
              ) {
                conflicts.add(`${q1.row},${q1.col}`);
                conflicts.add(`${q2.row},${q2.col}`);
              }
            }
          }

          // æ›´æ–°çš‡åå’Œå†²çª
          queens.forEach((queen) => {
            const square = document.querySelector(
              `[data-row="${queen.row}"][data-col="${queen.col}"]`
            );
            square.classList.add("queen");
            square.textContent = "â™•";

            if (conflicts.has(`${queen.row},${queen.col}`)) {
              square.classList.add("conflict");
            }
          });
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
          queensCountEl.textContent = queens.length;
          movesCountEl.textContent = moveCount;

          // è®¡ç®—å†²çªæ•°é‡
          let conflictCount = 0;
          const conflicts = new Set();
          for (let i = 0; i < queens.length; i++) {
            for (let j = i + 1; j < queens.length; j++) {
              const q1 = queens[i];
              const q2 = queens[j];

              if (
                q1.row === q2.row ||
                q1.col === q2.col ||
                Math.abs(q1.row - q2.row) === Math.abs(q1.col - q2.col)
              ) {
                conflicts.add(`${q1.row},${q1.col}`);
                conflicts.add(`${q2.row},${q2.col}`);
              }
            }
          }
          conflictsCountEl.textContent = conflicts.size;
        }

        // è®¾ç½®æ¶ˆæ¯
        function setMessage(text, type) {
          messageEl.textContent = text;
          messageEl.className = type;
        }

        // æ£€æŸ¥è·èƒœæ¡ä»¶
        function checkWin() {
          if (queens.length === boardSize) {
            const hasConflicts = queens.some((queen) => {
              return document
                .querySelector(
                  `[data-row="${queen.row}"][data-col="${queen.col}"]`
                )
                .classList.contains("conflict");
            });

            if (!hasConflicts) {
              setMessage(
                `ğŸ‰ æ­å–œï¼æ‚¨æˆåŠŸè§£å†³äº†${boardSize}çš‡åé—®é¢˜ï¼ç”¨äº† ${moveCount} æ­¥`,
                "success"
              );
              celebrateWin();
            } else {
              setMessage("çš‡åä¹‹é—´å­˜åœ¨æ”»å‡»ï¼è¯·è°ƒæ•´ä½ç½®", "error");
            }
          } else if (queens.length > 0) {
            const conflictCount = document.querySelectorAll(".conflict").length;
            if (conflictCount > 0) {
              setMessage(
                `å·²æ”¾ç½® ${queens.length}/${boardSize} ä¸ªçš‡åï¼Œ${conflictCount} ä¸ªå†²çª`,
                "error"
              );
            } else {
              setMessage(
                `å·²æ”¾ç½® ${queens.length}/${boardSize} ä¸ªçš‡åï¼Œç»§ç»­åŠ æ²¹ï¼`,
                "info"
              );
            }
          } else {
            setMessage(
              `ç‚¹å‡»æ£‹ç›˜æ”¾ç½®çš‡åã€‚ç›®æ ‡ï¼šæ”¾ç½®${boardSize}ä¸ªçš‡åä¸”äº’ä¸æ”»å‡»ï¼`,
              "info"
            );
          }
        }

        // åº†ç¥è·èƒœ
        function celebrateWin() {
          const squares = document.querySelectorAll(".queen");
          squares.forEach((square, index) => {
            setTimeout(() => {
              square.style.animation = "placeQueen 0.5s ease-out";
            }, index * 100);
          });
        }

        // æç¤ºåŠŸèƒ½
        function showHint() {
          if (queens.length === 0) {
            setMessage("æç¤ºï¼šå¯ä»¥ä»ç¬¬ä¸€è¡Œçš„ä»»æ„ä½ç½®å¼€å§‹æ”¾ç½®çš‡å", "info");
            return;
          }

          // æ‰¾åˆ°ä¸€ä¸ªå®‰å…¨çš„ä½ç½®
          for (let row = 0; row < boardSize; row++) {
            for (let col = 0; col < boardSize; col++) {
              if (!boardState[row][col] && isSafe(row, col)) {
                const square = document.querySelector(
                  `[data-row="${row}"][data-col="${col}"]`
                );
                square.style.background = "#90cdf4";
                setTimeout(() => {
                  square.classList.remove("light", "dark");
                  square.classList.add(
                    (row + col) % 2 === 0 ? "light" : "dark"
                  );
                }, 2000);
                setMessage(
                  `æç¤ºï¼šå°è¯•åœ¨ç¬¬ ${row + 1} è¡Œç¬¬ ${col + 1} åˆ—æ”¾ç½®çš‡å`,
                  "info"
                );
                return;
              }
            }
          }
          setMessage("å½“å‰æ²¡æœ‰å®‰å…¨çš„ä½ç½®ï¼Œå°è¯•ç§»åŠ¨ç°æœ‰çš„çš‡å", "info");
        }

        // æ£€æŸ¥ä½ç½®æ˜¯å¦å®‰å…¨
        function isSafe(row, col) {
          for (let queen of queens) {
            if (
              queen.row === row ||
              queen.col === col ||
              Math.abs(queen.row - row) === Math.abs(queen.col - col)
            ) {
              return false;
            }
          }
          return true;
        }

        // è‡ªåŠ¨æ±‚è§£ï¼ˆå›æº¯ç®—æ³•ï¼‰
        async function autoSolve() {
          if (isAnimating) return;

          isAnimating = true;
          solveBtn.disabled = true;
          setMessage("æ­£åœ¨è‡ªåŠ¨æ±‚è§£...", "info");

          // æ¸…ç©ºæ£‹ç›˜å’Œé«˜äº®
          clearHighlights();
          queens = [];
          boardState = Array(boardSize)
            .fill()
            .map(() => Array(boardSize).fill(0));
          updateBoard();
          updateStats();

          const solution = [];
          if (await solveNQueens(0, solution)) {
            // é€æ­¥æ˜¾ç¤ºè§£å†³æ–¹æ¡ˆ
            for (let i = 0; i < solution.length; i++) {
              await new Promise((resolve) => setTimeout(resolve, 500));
              const row = i;
              const col = solution[i];
              boardState[row][col] = 1;
              queens.push({ row, col });
              updateBoard();
              updateStats();
              // ä¸ºæ¯ä¸ªæ”¾ç½®çš„çš‡åæ·»åŠ æ°¸ä¹…é«˜äº®
              maintainHighlightForQueen(row, col);
            }
            setMessage("è‡ªåŠ¨æ±‚è§£å®Œæˆï¼è¿™æ˜¯å…¶ä¸­ä¸€ç§è§£æ³•", "success");
          } else {
            setMessage("æ±‚è§£å¤±è´¥", "error");
          }

          isAnimating = false;
          solveBtn.disabled = false;
        }

        // Nçš‡åå›æº¯ç®—æ³•
        async function solveNQueens(row, solution) {
          if (row === boardSize) {
            return true;
          }

          for (let col = 0; col < boardSize; col++) {
            if (isSafeForSolve(row, col, solution)) {
              solution[row] = col;
              if (await solveNQueens(row + 1, solution)) {
                return true;
              }
            }
          }
          return false;
        }

        // æ£€æŸ¥æ±‚è§£æ—¶çš„å®‰å…¨æ€§
        function isSafeForSolve(row, col, solution) {
          for (let i = 0; i < row; i++) {
            if (
              solution[i] === col ||
              Math.abs(solution[i] - col) === Math.abs(i - row)
            ) {
              return false;
            }
          }
          return true;
        }

        // äº‹ä»¶ç›‘å¬å™¨
        resetBtn.addEventListener("click", initBoard);
        hintBtn.addEventListener("click", showHint);
        solveBtn.addEventListener("click", autoSolve);
        applySizeBtn.addEventListener("click", updateBoardSize);

        // åˆå§‹åŒ–æ¸¸æˆ
        initBoard();
      });
    </script>
  </body>
</html>
